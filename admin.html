<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Chab'app Admin</title>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f5f3ef;--card:#fff;--border:#e4e0d8;--gold:#c9a84c;--gold-bg:#f8f4ea;--gold-dark:#8a7333;--text:#1c1c1c;--dim:#9a9590;--green:#2d8a4e;--green-bg:#eaf5ec;--red:#c0392b;--red-bg:#fdeaea;--r:14px;--shadow:0 1px 8px rgba(0,0,0,.06);--font:'DM Sans',-apple-system,sans-serif;--serif:'EB Garamond',Georgia,serif}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100dvh;padding-bottom:60px}
.hdr{padding:14px 20px;background:var(--card);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:10}
.hdr h1{font-family:var(--serif);font-size:20px;flex:1}
.badge{font-size:9px;background:var(--gold);color:#fff;padding:3px 8px;border-radius:20px;font-weight:700;letter-spacing:1px}
.back{display:block;padding:10px 20px;font-size:13px;color:var(--dim);text-decoration:none}
.wrap{max-width:540px;margin:0 auto;padding:0 16px}

.setup{display:none;padding:32px 0}
.setup.active{display:block}
.setup-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:24px;box-shadow:var(--shadow)}
.setup-card h2{font-family:var(--serif);font-size:20px;margin-bottom:6px}
.setup-card p{font-size:13px;color:var(--dim);line-height:1.7;margin-bottom:18px}
.setup-card a{color:var(--gold-dark);font-weight:600;text-decoration:none}
.setup-card code{background:var(--gold-bg);padding:2px 6px;border-radius:4px;font-size:12px;color:var(--gold-dark)}

.fld{margin-bottom:14px}
.fld-l{font-size:11px;font-weight:700;color:var(--dim);margin-bottom:5px;text-transform:uppercase;letter-spacing:.8px}
input[type="text"],input[type="password"],textarea{width:100%;padding:11px 13px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:var(--font);font-size:14px;outline:none;transition:border .2s,box-shadow .2s}
input:focus,textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px var(--gold-bg)}
textarea{min-height:160px;line-height:1.7;resize:vertical;font-family:var(--serif);font-size:15px}

.tabs{display:flex;margin:16px 0;background:var(--card);border-radius:var(--r);overflow:hidden;border:1px solid var(--border);box-shadow:var(--shadow)}
.tab{flex:1;padding:13px;text-align:center;font-size:13px;font-weight:600;cursor:pointer;transition:.2s;color:var(--dim);background:var(--card);border:none}
.tab.active{background:var(--gold);color:#fff}

.btn{padding:13px 20px;border:none;border-radius:10px;font-family:var(--font);font-size:14px;font-weight:700;cursor:pointer;transition:.15s}
.btn:active{transform:scale(.97)}
.btn-g{background:var(--gold);color:#fff;width:100%}
.btn-g:disabled{opacity:.4;cursor:not-allowed}
.btn-o{background:transparent;border:1.5px solid var(--border);color:var(--dim);width:100%}
.btn-d{background:var(--red-bg);color:var(--red);border:none;font-weight:700;cursor:pointer;border-radius:10px;padding:13px 14px}

.editor{display:none}.editor.active{display:block}

.dbar{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:14px;box-shadow:var(--shadow)}
.dbar-i{width:38px;height:38px;border-radius:10px;background:var(--gold-bg);display:flex;align-items:center;justify-content:center;font-size:16px}
.dbar-info{flex:1}
.dbar-main{font-family:var(--serif);font-size:17px;font-weight:700}
.dbar-sub{font-size:12px;color:var(--dim);margin-top:2px}
.dnav{display:flex;gap:4px}
.dnav button{width:32px;height:32px;border-radius:8px;border:1.5px solid var(--border);background:var(--card);color:var(--text);font-size:15px;cursor:pointer;transition:.15s}
.dnav button:active{background:var(--gold-bg)}

.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.sc{padding:14px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);text-align:center;box-shadow:var(--shadow)}
.sc-n{font-family:var(--serif);font-size:30px;font-weight:700;color:var(--gold-dark)}
.sc-l{font-size:11px;color:var(--dim);margin-top:3px;font-weight:600}

.ext{padding:12px 14px;background:var(--green-bg);border:1px solid #c8e6c9;border-radius:var(--r);margin-bottom:14px}
.ext-l{font-size:10px;color:var(--green);font-weight:700;margin-bottom:5px;text-transform:uppercase;letter-spacing:1px}
.ext-c{font-family:var(--serif);font-size:14px;line-height:1.7;color:#555;max-height:100px;overflow-y:auto}

.acts{display:flex;gap:10px;margin:14px 0 20px}
.acts .btn-g{flex:3}
.acts .btn-d{flex:1}

.help{margin-top:20px;padding:18px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow)}
.help-t{font-size:12px;font-weight:700;color:var(--dim);margin-bottom:12px;letter-spacing:.3px}
.hs{display:flex;gap:10px;margin-bottom:10px;align-items:flex-start}
.hs-n{width:22px;height:22px;border-radius:50%;background:var(--gold);color:#fff;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.hs-t{font-size:13px;color:var(--dim);line-height:1.6}
.hs-t strong{color:var(--text)}

.rst{margin-top:14px}

.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(100px);padding:11px 22px;border-radius:30px;font-size:13px;font-weight:600;z-index:100;transition:transform .3s ease;pointer-events:none;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,.15)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.success{background:var(--green);color:#fff}
.toast.error{background:var(--red);color:#fff}
</style>
</head>
<body>
<div class="hdr"><h1>Chab'app Admin</h1><span class="badge">ADMIN</span></div>
<a href="index.html" class="back">‚Üê Retour √† l'app</a>
<div class="wrap">
<div id="setup-screen" class="setup">
<div class="setup-card">
<h2>üîê Configuration</h2>
<p>Tu as besoin d'un <strong>token GitHub</strong> avec acc√®s au repo <code>770lab/tehilim</code>.<br><br>
<a href="https://github.com/settings/tokens/new?scopes=repo&description=Chabapp%20Admin" target="_blank">‚Üí Cr√©er un token</a> (permission "Contents: Read and write")</p>
<div class="fld"><div class="fld-l">Token GitHub</div><input type="password" id="setup-token" placeholder="github_pat_xxxxxxxxxxxx"></div>
<div class="fld"><div class="fld-l">Repo</div><input type="text" id="setup-repo" value="770lab/tehilim"></div>
<button class="btn btn-g" onclick="saveSetup()">Continuer ‚Üí</button>
</div>
</div>
<div id="main-screen" style="display:none">
<div class="tabs"><div class="tab active" id="tab-hyy" onclick="switchTab('hyy')">üìú Hayom Yom</div><div class="tab" id="tab-rambam" onclick="switchTab('rambam')">üìö Rambam</div></div>
<div id="editor-hyy" class="editor active">
<div class="stats" id="hyy-stats"></div>
<div class="dbar"><div class="dbar-i">üìÖ</div><div class="dbar-info"><div class="dbar-main" id="hyy-hd"></div><div class="dbar-sub" id="hyy-gd"></div></div><div class="dnav"><button onclick="nav('hyy',-1)">‚Äπ</button><button onclick="nav('hyy',0)" style="font-size:9px">‚óè</button><button onclick="nav('hyy',1)">‚Ä∫</button></div></div>
<div id="hyy-ext" class="ext" style="display:none"><div class="ext-l">‚úì Texte existant</div><div class="ext-c" id="hyy-ext-t"></div></div>
<div class="fld"><div class="fld-l">Texte fran√ßais du jour</div><textarea id="hyy-ta" placeholder="Colle ici le texte du Hayom Yom..."></textarea></div>
<div class="acts"><button class="btn btn-g" onclick="save('hyy')" id="hyy-btn">üíæ Sauvegarder</button><button class="btn-d" onclick="del('hyy')">üóë</button></div>
</div>
<div id="editor-rambam" class="editor">
<div class="stats" id="rambam-stats"></div>
<div class="dbar"><div class="dbar-i">üìÖ</div><div class="dbar-info"><div class="dbar-main" id="rambam-hd"></div><div class="dbar-sub" id="rambam-gd">Rambam 1 Chapitre</div></div><div class="dnav"><button onclick="nav('rambam',-1)">‚Äπ</button><button onclick="nav('rambam',0)" style="font-size:9px">‚óè</button><button onclick="nav('rambam',1)">‚Ä∫</button></div></div>
<div id="rambam-ext" class="ext" style="display:none"><div class="ext-l">‚úì Texte existant</div><div class="ext-c" id="rambam-ext-t"></div></div>
<div class="fld"><div class="fld-l">Titre du chapitre</div><input type="text" id="rambam-ti" placeholder="Ex: Hilkhot Yessodei HaTorah, Ch. 1"></div>
<div class="fld"><div class="fld-l">Texte fran√ßais</div><textarea id="rambam-ta" placeholder="Colle ici le texte du Rambam..."></textarea></div>
<div class="acts"><button class="btn btn-g" onclick="save('rambam')" id="rambam-btn">üíæ Sauvegarder</button><button class="btn-d" onclick="del('rambam')">üóë</button></div>
</div>
<div class="help">
<div class="help-t">Comment √ßa marche ?</div>
<div class="hs"><div class="hs-n">1</div><div class="hs-t">Va sur <strong>fr.chabad.org</strong> et copie le texte du jour</div></div>
<div class="hs"><div class="hs-n">2</div><div class="hs-t">Colle-le ici et clique <strong>Sauvegarder</strong></div></div>
<div class="hs"><div class="hs-n">3</div><div class="hs-t">L'app se met √† jour en <strong>1-2 minutes</strong></div></div>
<div class="hs"><div class="hs-n">üí°</div><div class="hs-t">Le Hayom Yom est index√© par date <strong>h√©bra√Øque</strong> ‚Äî une fois les 365 entr√©es remplies, c'est permanent !</div></div>
</div>
<div class="rst"><button class="btn btn-o" onclick="resetSetup()" style="font-size:12px">‚öôÔ∏è Reconfigurer le token</button></div>
</div>
</div>
<div class="toast" id="toast"></div>
<script>
var REPO='770lab/tehilim',FILE_PATH='hyy-data.json',API='https://api.github.com';
var D={hayom_yom:{},rambam:{}},sha=null,hOff=0,rOff=0;
function fl(x){return Math.floor(x)}function md(x,y){return x-y*fl(x/y)}
function hE(y){var m=fl((235*y-234)/19),p=12084+13753*m,d=29*m+fl(p/25920);if(md(3*(d+1),7)<3)d++;return d}
function hYD(y){return hE(y+1)-hE(y)}function isL(y){return md(7*y+1,19)<7}
function hMD(y,m){if(m==2)return hYD(y)%10==5?30:29;if(m==3)return hYD(y)%10!=3?30:29;if(m==4)return 29;if(m==6)return isL(y)?30:29;if(m==7)return isL(y)?29:0;if(m==9||m==11||m==13)return 29;return 30}
function gTA(gy,gm,gd){var a=fl((gy-1)/4)-fl((gy-1)/100)+fl((gy-1)/400),b=365*(gy-1)+a+gd,ml=[0,31,28,31,30,31,30,31,31,30,31,30];for(var i=1;i<gm;i++)b+=ml[i];if(gm>2&&((gy%4==0&&gy%100!=0)||gy%400==0))b++;return b}
function g2h(gy,gm,gd){var abs=gTA(gy,gm,gd),hy=gy+3760,ep=-1373427;while(hE(hy+1)+ep<=abs)hy++;while(hE(hy)+ep>abs)hy--;var diy=abs-(hE(hy)+ep)+1,hm=1,m,mo=isL(hy)?[1,2,3,4,5,6,7,8,9,10,11,12,13]:[1,2,3,4,5,6,8,9,10,11,12,13];for(var i=0;i<mo.length;i++){m=hMD(hy,mo[i]);if(diy<=m){hm=mo[i];break}diy-=m}var n={1:'Tishrei',2:'Cheshvan',3:'Kislev',4:'Tevet',5:'Shevat',6:'Adar I',7:'Adar II',8:'Nisan',9:'Iyyar',10:'Sivan',11:'Tammuz',12:'Av',13:'Elul'},mn=n[hm]||'';if(hm==6&&!isL(hy))mn='Adar';return{hy:hy,hm:hm,hd:diy,mName:mn}}

function checkSetup(){var t=localStorage.getItem('chabapp_token'),r=localStorage.getItem('chabapp_repo');if(t&&r){REPO=r;$('setup-screen').style.display='none';$('main-screen').style.display='block';loadData()}else{$('setup-screen').classList.add('active')}}
function saveSetup(){var t=$('setup-token').value.trim(),r=$('setup-repo').value.trim();if(!t){toast('Token requis','error');return}localStorage.setItem('chabapp_token',t);localStorage.setItem('chabapp_repo',r||'770lab/tehilim');REPO=r||'770lab/tehilim';toast('OK !','success');setTimeout(function(){$('setup-screen').classList.remove('active');$('setup-screen').style.display='none';$('main-screen').style.display='block';loadData()},400)}
function resetSetup(){if(!confirm('R√©initialiser ?'))return;localStorage.removeItem('chabapp_token');location.reload()}
function $(id){return document.getElementById(id)}
function ghH(w){var t=localStorage.getItem('chabapp_token'),h={'Authorization':'token '+t,'Accept':'application/vnd.github.v3+json'};if(w)h['Content-Type']='application/json';return h}
function loadData(){toast('Chargement...','success');fetch(API+'/repos/'+REPO+'/contents/'+FILE_PATH,{headers:ghH()}).then(function(r){if(r.status===404){D={hayom_yom:{},rambam:{}};sha=null;ui();toast('Pr√™t !','success');return}if(!r.ok)return r.json().then(function(e){throw new Error(e.message||'HTTP '+r.status)});return r.json()}).then(function(f){if(!f)return;sha=f.sha;var c=atob(f.content.replace(/\n/g,'')),b=new Uint8Array(c.length);for(var i=0;i<c.length;i++)b[i]=c.charCodeAt(i);D=JSON.parse(new TextDecoder('utf-8').decode(b));if(!D.hayom_yom)D.hayom_yom={};if(!D.rambam)D.rambam={};ui();toast('Donn√©es charg√©es !','success')}).catch(function(e){console.error(e);toast('Erreur: '+e.message,'error')})}
function commit(msg){var j=JSON.stringify(D,null,2),enc=btoa(unescape(encodeURIComponent(j))),body={message:msg||'Update',content:enc};if(sha)body.sha=sha;return fetch(API+'/repos/'+REPO+'/contents/'+FILE_PATH,{method:'PUT',headers:ghH(true),body:JSON.stringify(body)}).then(function(r){if(!r.ok)return r.json().then(function(e){throw new Error(e.message||'HTTP '+r.status)});return r.json()}).then(function(r){sha=r.content.sha;return r})}

function gd(t){var o=t==='hyy'?hOff:rOff,d=new Date();d.setDate(d.getDate()+o);return d}
function hK(d){var h=g2h(d.getFullYear(),d.getMonth()+1,d.getDate());return h.mName.replace(' ','_')+'_'+h.hd}
function rK(d){return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate()}
function nav(t,dir){if(dir===0){if(t==='hyy')hOff=0;else rOff=0}else{if(t==='hyy')hOff+=dir;else rOff+=dir}ui()}
function switchTab(t){$('tab-hyy').classList.toggle('active',t==='hyy');$('tab-rambam').classList.toggle('active',t==='rambam');$('editor-hyy').classList.toggle('active',t==='hyy');$('editor-rambam').classList.toggle('active',t==='rambam')}
var MO=['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'];
function ui(){
var dd=gd('hyy'),h=g2h(dd.getFullYear(),dd.getMonth()+1,dd.getDate()),k=hK(dd);
$('hyy-hd').textContent=h.mName+' '+h.hd+' '+h.hy;
$('hyy-gd').textContent=dd.getDate()+' '+MO[dd.getMonth()]+' '+dd.getFullYear();
var ex=D.hayom_yom[k];if(ex){$('hyy-ext').style.display='block';$('hyy-ext-t').textContent=ex;$('hyy-ta').value=ex}else{$('hyy-ext').style.display='none';$('hyy-ta').value=''}
var hc=Object.keys(D.hayom_yom).length;
$('hyy-stats').innerHTML='<div class="sc"><div class="sc-n">'+hc+'</div><div class="sc-l">Remplies</div></div><div class="sc"><div class="sc-n">'+(354-hc)+'</div><div class="sc-l">Restantes</div></div>';
var rd=gd('rambam'),rk=rK(rd);
$('rambam-hd').textContent=rd.getDate()+' '+MO[rd.getMonth()]+' '+rd.getFullYear();
var re=D.rambam[rk],rel=$('rambam-ext');
if(re){rel.style.display='block';$('rambam-ext-t').textContent=(re.title?re.title+'\n\n':'')+(re.text||re);$('rambam-ti').value=re.title||'';$('rambam-ta').value=re.text||re||''}else{rel.style.display='none';$('rambam-ti').value='';$('rambam-ta').value=''}
var rc=Object.keys(D.rambam).length;
$('rambam-stats').innerHTML='<div class="sc"><div class="sc-n">'+rc+'</div><div class="sc-l">Jours remplis</div></div><div class="sc"><div class="sc-n">'+(re?'‚úì':'‚Äî')+'</div><div class="sc-l">Aujourd\'hui</div></div>'}

function save(t){var d=gd(t),txt,msg;
if(t==='hyy'){txt=$('hyy-ta').value.trim();if(!txt){toast('Texte vide !','error');return}var k=hK(d);D.hayom_yom[k]=txt;var h=g2h(d.getFullYear(),d.getMonth()+1,d.getDate());msg='HYY: '+h.mName+' '+h.hd}
else{txt=$('rambam-ta').value.trim();var ti=$('rambam-ti').value.trim();if(!txt){toast('Texte vide !','error');return}var k=rK(d);D.rambam[k]={title:ti,text:txt};msg='Rambam: '+k}
var b=$(t+'-btn');b.disabled=true;b.textContent='‚è≥...';
commit(msg).then(function(){toast('‚úì Sauvegard√© !','success');b.textContent='‚úì';setTimeout(function(){b.textContent='üíæ Sauvegarder';b.disabled=false},1500);ui()}).catch(function(e){toast('Erreur: '+e.message,'error');b.textContent='üíæ Sauvegarder';b.disabled=false})}

function del(t){if(!confirm('Supprimer ?'))return;var d=gd(t);if(t==='hyy')delete D.hayom_yom[hK(d)];else delete D.rambam[rK(d)];commit('Delete').then(function(){toast('Supprim√© !','success');ui()}).catch(function(e){toast('Erreur: '+e.message,'error')})}
function toast(m,t){var e=$('toast');e.textContent=m;e.className='toast '+(t||'success')+' show';setTimeout(function(){e.classList.remove('show')},3000)}
checkSetup();
</script>
</body>
</html>
